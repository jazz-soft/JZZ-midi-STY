<!DOCTYPE html>
<html lang=en>
<head>
<title>Style View</title>
<script src="node_modules/jzz/javascript/JZZ.js"></script>
<script src="node_modules/jzz-synth-tiny/javascript/JZZ.synth.Tiny.js"></script>
<script src="node_modules/jzz-midi-smf/javascript/JZZ.midi.SMF.js"></script>
<script src="javascript/JZZ.midi.STY.js"></script>
<style>
.knob { width:1em; height:1em; display:inline-block; margin-left:.2em; margin-right:.2em; }
.knobb { width:1em; height:1em; display:inline-block; margin-left:.2em; margin-right:.2em; text-align:center; background-color:#ddd; line-height:1em; vertical-align:middle; margin=0; }
.title { min-width:8em; display:inline-block; margin-right:.2em; font-weight:bold; }
.drop { margin-left:1.5em; }
.hide { display:none; }
</style>
</head>

<body>

<h1>Style View</h1>
<p id=panel>Please enable JavaScript!</p>

<script>
var panel = document.getElementById('panel');
panel.innerHTML = 'Please run <tt style="background-color:#bbf;"><b>npm install</b></tt> to enable this test.';
JZZ.synth.Tiny.register('Web Audio');
var SMF = JZZ.MIDI.SMF;
var STY = JZZ.MIDI.STY;
panel.innerHTML = '';
var input = document.createElement('input');
input.type = 'file';
input.accept = '.sty,.sst,.prs';
input.addEventListener("change", load_file);
panel.appendChild(input);
panel.appendChild(document.createElement('hr'));
var display = document.createElement('div');
panel.appendChild(display);
var gui;

function load_file() {
  if (window.FileReader) {
    var reader = new FileReader();
    reader.onload = function(e) { load_sty(e.target.result); };
    reader.readAsArrayBuffer(input.files[0]);
  }
  else alert('File API is not supported in this browser.');
}
function load_sty(data) {
  try {
    var sty = new STY(data);
    display_sty(sty);
  }
  catch (err) { alert(err.message); }
}
function display_sty(sty) {
  display.innerHTML = '';
  gui = new Cell(display, 0, 'Style', 'coming soon...', sty);
  gui.populate = populate;
  gui.expand();
}

function Cell(parent, type, title, text, ref) {
  var self = this;
  this.div = document.createElement('div');
  var knob = square(type);//document.createElement('span');
  if (type == 1) {
    knob.innerHTML = '+';
    knob.addEventListener('click', function() {
      if (self.exp) {
        self.collapse();
        knob.innerHTML = '+';
      }
      else {
        self.expand();
        knob.innerHTML = '-';
      }
      self.exp = !self.exp;
    });
  }
  this.div.appendChild(knob);
  var span = document.createElement('span');
  span.className = 'title';
  span.innerHTML = title;
  this.div.appendChild(span);
  span = document.createElement('span');
  span.innerHTML = text;
  this.div.appendChild(span);
  this.ref = ref;
  parent.appendChild(this.div);
}
Cell.prototype.expand = function() {
  if (!this.more) {
    this.more = document.createElement('div');
    this.more.className = 'drop';
    if (this.populate) this.populate();
    this.div.appendChild(this.more);
  }
  this.more.classList.remove('hide');
}
Cell.prototype.collapse = function() {
  this.more.classList.add('hide');
}
function square(t, s) {
  sq = document.createElement('span');
  sq.className = t ? 'knobb' : 'knob';
  if (s) sq.innerHTML = s;
  return sq;
}
function populate() {
  this.cells = [];
}
</script>

</body>
</html>
